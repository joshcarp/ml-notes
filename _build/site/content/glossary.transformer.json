{"kind":"Article","sha256":"7060c0b72c0e2b4fb875edaaca56bcc97f4ec8b782c807b3bdceb78d5132309a","slug":"glossary.transformer-1","location":"/glossary/transformer.md","dependencies":[],"frontmatter":{"title":"The Transformer","content_includes_title":false,"github":"https://github.com/joshcarp/ml-notes","exports":[{"format":"md","filename":"transformer.md","url":"/transformer-90c8b74b0296b32392127653a371addf.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","children":[{"type":"text","value":"üì¢ TLDR: Links and notes to transformer related research papers.","key":"AlmRjQeHns"}],"key":"y2lHblD03e"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Below is a list of all the important research papers to fully understand the transformer architecture as introduced in the ‚ÄúAttention is all you need‚Äù paper by Google in 2017.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"H25fElbCFv"}],"key":"ly1cso7yT5"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"This page has a collection of research papers + notes in a directed graph to indicate dependencies between the papers and is to be used as a reference page. Obviously there‚Äôs still more to add (RNNs, LSTMs, etc), and they are on my reading list and will be added in time.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"HTDtr5adq1"}],"key":"rb2ggLWE8B"},{"type":"mermaid","value":"%%{init: {'theme': 'base', 'themeVariables': { 'nodeTextColor': '#333333', 'mainBkg': '#f0f0f0', 'lineColor': '#F8B229'}}}%%\n\ngraph TD\n\t\ttitle[Research Collections: The Transformer]\n    subgraph \"Neural Networks: Learning\"\n        A[\"<a href='https://www.cs.utoronto.ca/~hinton/absps/naturebp.pdf'>Learning representations by back-propagating errors</a>\"]\n        B[\"<a href='https://arxiv.org/abs/1512.03385'>Deep Residual Learning</a>\"]\n        C[\"<a href='https://arxiv.org/abs/1412.6980'>Adam: A Method for Stochastic Optimization</a>\"]\n        D[\"<a href='https://arxiv.org/abs/1711.05101'>Decoupled Weight Decay Regularization</a>\"]\n    end\n\n    subgraph \"Model Components\"\n        E[\"<a href='https://arxiv.org/abs/1606.08415v5'>Gaussian Error Linear Units (GELUs)</a>\"]\n        F[\"<a href='https://arxiv.org/abs/1607.06450'>Layer Normalization</a>\"]\n    end\n\n    subgraph \"The Transformer\"\n\t\t    G[\"<a href='https://arxiv.org/abs/1706.03762v7'>Attention Is All You Need</a>\"]\n        X[\"<a href='https://arxiv.org/abs/1911.02150'>Fast Transformer Decoding: One Write-Head is All You Need</a>\"]\n        H[\"<a href='https://cdn.openai.com/research-covers/language-unsupervised/language_understanding_paper.pdf'>Improving Language Understanding by Generative Pre-Training</a>\"]\n\n    end\n\n    subgraph \"Training LLMs\"\n\t\t\t\tI[\"<a href='https://arxiv.org/abs/1706.03741'>Deep reinforcement learning from human preferences</a>\"]\n        J[\"<a href='https://arxiv.org/abs/2203.02155'>Training language models to follow instructions with human feedback</a>\"]\n    end\n\n    A --> B\n    B --> G\n    C --> D\n    D --> G\n    E --> G\n    F --> G\n    G --> X\n    X --> H\n    H --> J\n    I --> J","position":{"start":{"line":11,"column":1},"end":{"line":50,"column":1}},"key":"p3iSSJGWMk"},{"type":"heading","depth":2,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Neural Networks","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"fw9ULznqAh"}],"identifier":"neural-networks","label":"Neural Networks","html_id":"neural-networks","implicit":true,"key":"WdhpMk0uP1"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Neural networks have been around for a while and these are core components of what allows neural networks and transformers to be effective at what they do.","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"Sno1A8VaW1"}],"key":"EEHWdxNtFb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":56,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":56,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"link","url":"https://www.cs.utoronto.ca/~hinton/absps/naturebp.pdf","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"**Learning representations by back-propagating errors","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"cRPUTMppbF"}],"urlSource":"https://www.cs.utoronto.ca/~hinton/absps/naturebp.pdf","key":"hrPHLwrpiX"},{"type":"text","value":" -** Back-propagation was introduced here, couldn‚Äôt find the original paper. This was done by Hinton and co and was what lead to the AI era of the 80s. Before this paper Multi-layer-perceptrons (MLPs) weren‚Äôt very common because they were very, very difficult to train.","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"oac9472EGl"}],"key":"JThTKNJbuD"}],"key":"rxy9odUZ2F"},{"type":"listItem","spread":true,"position":{"start":{"line":58,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/abs/1512.03385","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"**Deep Residual Learning for Image Recognition","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"EwPwSKGuSU"}],"urlSource":"https://arxiv.org/abs/1512.03385","key":"p63cjevOKc"},{"type":"text","value":"** - The introduction of residuals (also known as skip connections) allowed for deeper networks. Before this paper the depth of a neural network was limited because it would diverge enough and back propagation was really, really difficult to do because of vanishing gradients. Residuals essentially have a ‚Äúshort circuit‚Äù past a block which allows for gradients to flow backwards through back propagation to earlier components without needing to go through intermediate layers. This greatly speeds up convergence.","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"wB5EE4iQho"}],"key":"LLmcxZ6OzU"}],"key":"a86efxmSGN"},{"type":"listItem","spread":true,"position":{"start":{"line":60,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/abs/1607.06450","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"**Layer Normalization","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"vQdM24ocJh"}],"urlSource":"https://arxiv.org/abs/1607.06450","key":"eOlJ0CnZ9I"},{"type":"text","value":" -** Layernorm happens in each layer to make sure that the values don‚Äôt explode and is applied at each layers output activations. It makes the surface more regular so that it‚Äôs more symmetrical and easier to optimize over. This means that weight updates can take the same increment step in all directions and not need to worry about overstepping in one dimension but under-stepping in another, and the outputs of the activations will be more regular so that the inputs to the activation functions are all within the same order of magnitude - for example one input to a neuron being 0.00001 and another one being 1,000,000 would cause a lot of problems for floating point rounding and quantization, for example.","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"IJP9bmfYzN"}],"key":"mKnXAluF1s"}],"key":"xNA9XQpXxS"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/abs/1606.08415v5","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"**Gaussian Error Linear Units (GELUs)","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"lZJ8FjJzxH"}],"urlSource":"https://arxiv.org/abs/1606.08415v5","key":"VVJV2iWEmK"},{"type":"text","value":" -** Activation function ****that leaves positive values unchanged but maps negative numbers to near zero. Implemented here in ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"ZBfcvHCK26"},{"type":"link","url":"https://github.com/joshcarp/llm.go/blob/56de2430b95ff3f89657637a4c97794653a994ec/math.go#L414","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"llm.go","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"rxmcIgkV4m"}],"urlSource":"https://github.com/joshcarp/llm.go/blob/56de2430b95ff3f89657637a4c97794653a994ec/math.go#L414","data":{"kind":"file","org":"joshcarp","repo":"llm.go","reference":"56de2430b95ff3f89657637a4c97794653a994ec","file":"math.go","from":414,"raw":"https://raw.githubusercontent.com/joshcarp/llm.go/56de2430b95ff3f89657637a4c97794653a994ec/math.go"},"internal":false,"protocol":"github","key":"NJ6yPVWgi5"},{"type":"text","value":". Other architectures use different activation functions. For example, OpenElm uses SwiGLU FFN which I don‚Äôt exactly understand. Should probably add that to the reading list.","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"B6kx30DKJZ"}],"key":"yJ7ZhizJmq"}],"key":"JtoagQtBDF"}],"key":"iXDHpW7Zs7"},{"type":"heading","depth":2,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Optimizers","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"BEEpfTKw0A"}],"identifier":"optimizers","label":"Optimizers","html_id":"optimizers","implicit":true,"key":"RF3hNeyfSj"},{"type":"paragraph","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"Optimizers are the functions that control how the weights get changed during training.","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"BWkDrzWP3V"}],"key":"yntmeZXSOP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":68,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/abs/1412.6980","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"**Adam: A Method for Stochastic Optimization","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"F11mBOcA8t"}],"urlSource":"https://arxiv.org/abs/1412.6980","key":"QePCXaeJ8N"},{"type":"text","value":" -** Introduced the Adam optimiser. Weight updates are important because it causes the training to converge more quickly. Adam has two parameters for each model parameter.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"dvlBK9lLfH"}],"key":"WP6B89TnG4"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/abs/1711.05101","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"**Decoupled Weight Decay Regularization","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"ERVOvDWItQ"}],"urlSource":"https://arxiv.org/abs/1711.05101","key":"xIoHgw9DZv"},{"type":"text","value":" -** Introduces AdamW optimiser used in the first transformer. Adam with weight where weight increases as time goes on.","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"Z5ktiuvtsc"}],"key":"IEbtJHyHXs"}],"key":"C6WzmUWXrQ"},{"type":"heading","depth":2,"position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"The Transformer","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"yhHQbcakJG"}],"identifier":"the-transformer","label":"The Transformer","html_id":"the-transformer","implicit":true,"key":"lijeDaIrmR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":73,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/abs/1706.03762v7","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"**Attention Is All You Need","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"PXBan1OUT0"}],"urlSource":"https://arxiv.org/abs/1706.03762v7","key":"NebcuRfyDq"},{"type":"text","value":" -** The OG introduced the idea of self-attention and the encoder/decoder architecture for language translation tasks (the encoder later got dropped because it was only used for translation). Another breakthrough from this paper was the training; ‚ÄúThe Transformer allows for significantly more parallelisation and can reach a new state of the art in translation quality after being trained for as little as twelve hours on eight P100 GPUs.‚Äù - This fact here was what let it: overtake RNNs (which weren‚Äôt parallelisable), and lead NVIDIA to be worth more than 2.7 Trillion token credits.","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"KaquGqzlog"}],"key":"Y0zKTbOlTr"}],"key":"rcJu13Z7w8"},{"type":"listItem","spread":true,"position":{"start":{"line":75,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"link","url":"https://cdn.openai.com/research-covers/language-unsupervised/language_understanding_paper.pdf","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"**Improving Language Understanding by Generative Pre-Training","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"iYDhUqDuaC"}],"urlSource":"https://cdn.openai.com/research-covers/language-unsupervised/language_understanding_paper.pdf","key":"Uhf5bo17Vy"},{"type":"text","value":" -** This paper introduced the ‚ÄúGPT‚Äù which was a breakthrough at the time. It introduced the idea of using next token prediction as a way to do self-supervised learning, which meant that we can put all of the internet into it and with a simple loss function over the vocabulary adjust the weights via back propagation.","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"B4q5l5PXld"}],"key":"lmTGQ9g9Vn"}],"key":"SznYGOCjta"},{"type":"listItem","spread":true,"position":{"start":{"line":77,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":77,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/pdf/1911.02150","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"**Fast Transformer Decoding: One Write-Head is All\nYou Need","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"TAEFSJUC25"}],"urlSource":"https://arxiv.org/pdf/1911.02150","key":"jq9NuD7uK3"},{"type":"text","value":" -** People always point to the original Attention is all you need paper or the GPT paper that introduced the ","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"VIHtlyIIX6"},{"type":"emphasis","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"decoder only","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"j2bmPALHtP"}],"key":"ZesbSBhD43"},{"type":"text","value":" model~~, but this one was the first one that actually used it in practice. It also has very nice implementations of a transformer in python.~~  This previous explanation was incorrect as the GPT paper was released in 2018, a full year before this paper was released. The GPT paper introduced the concept of a decoder only model, but this paper coined the term ‚Äúdecoder only‚Äù model (I think)","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"GlMyiY8vas"}],"key":"C2Ty3QyVf8"}],"key":"c9QzBZ7Yuq"}],"key":"yhq1OUTG0V"},{"type":"heading","depth":2,"position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"Training","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"msPSKgxje2"}],"identifier":"training","label":"Training","html_id":"training","implicit":true,"key":"is0MSWT0NN"},{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"These papers introduced methods to align LLMs to human preferences, and therefore allow them to be useful as chatbots/instruct models, etc.","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"g8AU1vmuPg"}],"key":"zVjYr6OpCl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":84,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":84,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/abs/1706.03741","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"**Deep Reinforcement Learning from Human Preferences","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"lBrANRFH5M"}],"urlSource":"https://arxiv.org/abs/1706.03741","key":"WddYc1txqV"},{"type":"text","value":" -** Reward modelling is introduced in this paper and allows for a small amount of human time to train a model that sits in as a ‚Äúhuman proxy‚Äù. This allows for the model to train multiple orders of magnitude more human-time efficient than having a human sit there for 1,000 years judging if a simulation looks like it‚Äôs walking correctly.","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"a6hnOwlYKw"}],"key":"pOHw3TZqGl"}],"key":"WZ45qISQ3F"},{"type":"listItem","spread":true,"position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/pdf/2203.02155","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"**Training language models to follow instructions with human feedback","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"jbjnNUjoF4"}],"urlSource":"https://arxiv.org/pdf/2203.02155","key":"tWGp5SwbUk"},{"type":"text","value":" -** Reinforcement learning used on language models for the first time. This is what allowed for ‚ÄúPre-Trained‚Äù (the P in GPT), to be useful for downstream tasks like being a chat-bot and other things.","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"WxwItz3kqp"}],"key":"F5zakBLJjH"}],"key":"tOfvEQ1UJ4"}],"key":"dCobsm23Ls"}],"key":"WA6wEaXKkY"}],"key":"RsC75OvIZt"},"references":{"cite":{"order":[],"data":{}}}}